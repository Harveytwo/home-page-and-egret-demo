var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function a(t){try{c(i.next(t))}catch(e){o(e)}}function s(t){try{c(i["throw"](t))}catch(e){o(e)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(a,s)}c((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(i){n=[6,i],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadResource()];case 1:return n.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=n.sent(),[4,platform.login()];case 3:return n.sent(),[4,platform.getUserInfo()];case 4:return e=n.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return n.sent(),this.stage.removeChild(t),[3,4];case 3:return e=n.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){this.addChild(ViewManager.getInstance())},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var common;!function(t){function e(){return egret.MainContext.instance.stage}function n(){return egret.MainContext.instance.stage.stageWidth}function i(){return egret.MainContext.instance.stage.stageHeight}function r(t,e){if(e)for(var n in t.items)t.items[n].props={loop:!0};t.play()}function o(t,e){if(null!=t){var n=RES.getRes(t);return n.play(0,e),n}console.log("声音文件为空！")}function a(t,e,n,i,r,o,a){var s=RES.getRes(a+"_json"),c=RES.getRes(a+"_png"),h=new egret.MovieClipDataFactory(s,c),l=new egret.MovieClip(h.generateMovieClipData(r));return l.x=n,l.y=i,e.addChild(l),l.gotoAndPlay(t,o),l.addEventListener(egret.Event.COMPLETE,function(t){e.removeChild(l)},this),l}function s(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e}function c(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e}function h(t){return t*(Math.PI/180)}function l(t){return t*(180/Math.PI)}function u(t,e){var n=e-t;if(0===n)return 0;var i=Math.floor((n- -180)/360);return n-360*i}function d(e){return t.Wrap(e,-180,180)}function p(t,e,n){var i=n-e;return e+((t-e)%i+i)%i}function g(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function f(t,e){return Math.random()*(e-t)+t}function m(t,e,n){return Math.max(e,Math.min(n,t))}function y(t,e,n){return(e-t)*n+t}function _(){var t=[1,-1];return t[Math.floor(2*Math.random())]}t.p2Debug=!0,t.curStage=e,t.curWidth=n,t.curHeight=i,t.playTweenAnimation=r,t.PlayBgSound=o,t.LoadMovieClipMovie=a,t.createBitmapByName=s,t.createBitmapByNameCenter=c,t.DegToRad=h,t.RadToDeg=l,t.ShortestBetween=u,t.WrapDegrees=d,t.Wrap=p,t.Between=g,t.FloatBetween=f,t.Clamp=m,t.Linear=y,t.PlusMinus=_,t.factor=50}(common||(common={}));var P2World=function(t){function e(e,n){void 0===e&&(e=0),void 0===n&&(n=-9.82);var i=t.call(this)||this;return i.world=new p2.World({gravity:[e,n]}),i.world.sleepMode=p2.World.BODY_SLEEPING,i.init(),i}return __extends(e,t),e.prototype.init=function(){if(this.updateWorld(),common.p2Debug){var t=new egret.Sprite;this.addChild(t)}},Object.defineProperty(e.prototype,"theWorld",{get:function(){return this.world},enumerable:!0,configurable:!0}),e.prototype.getBody=function(t,e){void 0===t&&(t=0),void 0===e&&(e=p2.Body.DYNAMIC);var n=new p2.Body({mass:t});return n.type=e,n.userData={},n},e.prototype.createPlane=function(t,e,n){void 0===t&&(t=Math.PI);var i=new p2.Plane,r=this.getBody(0,p2.Body.STATIC);return r.addShape(i),r.angle=t,r.position[0]=e,r.position[1]=n,this.world.addBody(r),r},e.prototype.createBoxBodyShape=function(t,e,n,i){void 0===n&&(n=p2.Body.DYNAMIC),void 0===i&&(i=0);var r=this.getBody(1,n),o=new p2.Box({width:t,height:e});return r.addShape(o),r.angle=i,this.world.addBody(r),r},e.prototype.createCircleBodyShape=function(t,e){void 0===e&&(e=p2.Body.DYNAMIC);var n=this.getBody(2,e),i=new p2.Circle({radius:t});return n.addShape(i),this.world.addBody(n),n},e.prototype.updateWorld=function(){var t=this;egret.Ticker.getInstance().register(function(e){if(!(10>e||e>300)){t.world.step(e/500);for(var n=common.curHeight(),i=t.world.bodies,r=i.length,o=0;r>o;o++){var a=i[o];if(a.userData&&a.userData.skin){var s=a.userData.skin;s&&(s.x=a.position[0]*common.factor,s.y=n-a.position[1]*common.factor,s.rotation=360-180*a.angle/Math.PI,a.sleepState==p2.Body.SLEEPING?s.alpha=.5:s.alpha=1)}}}},this)},e.prototype.stopWorld=function(){egret.Ticker.getInstance().pause()},e.prototype.resumeWorld=function(){egret.Ticker.getInstance().resume()},e}(egret.DisplayObjectContainer);__reflect(P2World.prototype,"P2World");var ScreenMovies;!function(t){function e(t,e){function n(t){v++,v==s&&(i.removeChild(a),e&&e())}var i=common.curStage(),r=common.curWidth(),o=common.curHeight(),a=new egret.Sprite;a.width=r,a.height=o,i.addChild(a);for(var s=40,c=5,h=s/c,l=0;s>l;l++){var u=r/c,d=o/h,p=l%c*u,g=Math.floor(l/c)*d,f=new egret.RenderTexture,m=(f.drawToTexture(i,new egret.Rectangle(p,g,u,d)),new egret.Bitmap);switch(m.texture=f,m.anchorOffsetX=u/2,m.anchorOffsetY=d/2,m.x=p+u/2,m.y=g+d/2,a.addChild(m),5==t&&(t=Math.ceil(4*Math.random())),t){case 1:var y=egret.Tween.get(m);y.to({scaleX:0,scaleY:0,alpha:0,rotation:359},800,egret.Ease.circIn).call(n,this);break;case 2:var _=-r;l%2||(_=2*r);var y=egret.Tween.get(m);y.to({x:_,alpha:0},800,egret.Ease.circIn).call(n,this);break;case 3:var y=egret.Tween.get(m);y.to({scaleX:.2,scaleY:1,alpha:0,blurFliter:0},800,egret.Ease.backInOut).call(n,this);break;case 4:var y=egret.Tween.get(m);y.to({alpha:0},900,egret.Ease.circIn).call(n,this);break;default:var y=egret.Tween.get(m);y.to({scaleX:1,scaleY:0,alpha:0},800,egret.Ease.circIn).call(n,this)}}var v=0}t.MovieStart=e}(ScreenMovies||(ScreenMovies={}));var ViewManager=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.init=function(){this.sceneBegin=new SceneBegin,this.sceneGame=new SceneGame,this.start()},e.prototype.start=function(){this.initListener(),this.addChild(this.sceneGame),this.sceneGame.start()},e.prototype.initListener=function(){this.addEventListener(SceneEvents.SCENE_CHANGE,this.onChangeScene,this)},e.prototype.beginGame=function(){this.sceneGame.start(),this.sceneBegin.end(),this.addChildAt(this.sceneGame,0),this.removeChild(this.sceneBegin)},e.prototype.backHome=function(){this.sceneBegin.start(),this.sceneGame.end(),this.addChildAt(this.sceneBegin,0),this.removeChild(this.sceneGame)},e.prototype.curStage=function(){return common.curStage()},e.prototype.onChangeScene=function(t){switch(t.eventType){case SceneEvents.BEGIN_GAME:this.beginGame();break;case SceneEvents.BACK_HOME:this.backHome()}},e}(egret.DisplayObjectContainer);__reflect(ViewManager.prototype,"ViewManager");var SceneEvents=function(t){function e(e,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),t.call(this,e,n,i)||this}return __extends(e,t),e.SCENE_CHANGE="scene_change",e.BEGIN_GAME="begin_game",e.BACK_HOME="back_home",e.GAME_END="gameend",e}(egret.Event);__reflect(SceneEvents.prototype,"SceneEvents");var SceneBegin=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.start=function(){this.start_btn.touchEnabled=!0,this.start_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this)},e.prototype.end=function(){this.start_btn.touchEnabled=!1,this.start_btn.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&this.start_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this)},e.prototype.init=function(){this.createBg(),this.createBtns()},e.prototype.startGame=function(){var t=new SceneEvents(SceneEvents.SCENE_CHANGE);t.eventType=SceneEvents.BEGIN_GAME,t.eventObj=this,ViewManager.getInstance().dispatchEvent(t)},e.prototype.createBg=function(){this.bg=new egret.Bitmap(RES.getRes("bg_menu_jpg")),this.bg.height=common.curHeight(),this.addChild(this.bg)},e.prototype.createBtns=function(){this.start_btn||(this.start_btn=new egret.Sprite,this.addChild(this.start_btn));var t=new egret.Bitmap(RES.getRes("but_play_png")),e=new egret.TextField;e.text="START GAME",e.size=24,e.fontFamily="Arial",e.textColor=16777215,e.bold=!0,e.textAlign="center",e.width=t.width,e.y=(t.height-e.height)/2-1,this.start_btn.addChild(t),this.start_btn.addChild(e),this.start_btn.y=common.curHeight()-200,this.start_btn.x=(common.curWidth()-t.width)/2},e}(egret.DisplayObjectContainer);__reflect(SceneBegin.prototype,"SceneBegin");var SceneGame=function(t){function e(){var e=t.call(this)||this;return e._h=common.curHeight()-150,e.init(),e}return __extends(e,t),e.prototype.start=function(){this.btn_exit.touchEnabled=!0,this.btn_exit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHome,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ballAnim,this)},e.prototype.end=function(){},e.prototype.init=function(){this.createBg(),this.addWorld()},e.prototype.createBg=function(){this.btn_exit=new egret.Bitmap(RES.getRes("but_exit_png")),this.bg=new egret.Bitmap(RES.getRes("bg_game_jpg")),this.bg.height=common.curHeight(),this.addChild(this.bg),this.addChild(this.btn_exit),this.btn_exit.x=common.curWidth()-this.btn_exit.width-40,this.btn_exit.y=40,this.gameCon=new egret.Sprite,this.addChild(this.gameCon),this.shadow=new egret.Bitmap(RES.getRes("shadow_png")),this.shadow.anchorOffsetX=this.shadow.width/2,this.shadow.anchorOffsetY=this.shadow.height/2,this.shadow.x=common.curWidth()/2,this.shadow.y=common.curHeight()-150,this.gameCon.addChild(this.shadow),this.ball=common.createBitmapByName("ball_1_png"),this.gameCon.addChild(this.ball),this.ball.anchorOffsetX=this.ball.width/2,this.ball.anchorOffsetY=this.ball.height/2},e.prototype.personShow=function(t){var e=this,n=t.stageX,i=t.stageY,r={x:0,y:0},o=1,a=0,s=0,c=0,h=0,l={one:!1,two:!1,three:!1,four:!1,five:!1,six:!1,seven:!1};return l.six=!0,i>=8*this._h/10?l.one=!0:(i>=7*this._h/10?l.two=!0:!1,i>=6*this._h/10?l.four=!0:!1,i>=4*this._h/10?l.three=!0:!1,i>=3*this._h/10?l.five=!0:!1,i>=0*this._h/10?l.seven=!0:!1),l.one?(a=1,c=16,h=720,s=i-this.ball.height/4,r=this.getForce(common.Between(2,6),common.Between(24,28)),n>=common.curWidth()/2?o=-1:(o=1,r.x=-r.x)):l.two?(a=2,c=28,h=675,s=i-this.ball.height/4,r=this.getForce(common.Between(4,6),common.Between(24,28)),n>=common.curWidth()/2?o=-1:(o=1,r.x=-r.x)):l.four?(a=4,c=440,h=410,s=i-this.ball.height/2,r=this.getForce(common.Between(10,16),common.Between(28,34)),n>=common.curWidth()/2?(o=1,r.x=-r.x):o=-1):l.three?(a=3,c=51,h=358,s=i-this.ball.height/2,r=this.getForce(common.Between(6,10),common.Between(28,32)),n>=common.curWidth()/2?o=-1:(o=1,r.x=-r.x)):l.five?(a=5,c=196,h=132,s=i-this.ball.height/2,r=this.getForce(common.Between(10,20),common.Between(26,30)),n>=common.curWidth()/2?(o=1,r.x=-r.x):o=-1):l.seven&&(a=7,c=229,h=3,s=i-this.ball.height/2,r=this.getForce(common.Between(10,20),common.Between(28,30)),n>=common.curWidth()/2?(o=1,r.x=-r.x):o=-1),this.person=new egret.Bitmap(RES.getRes("player_sprite_"+a+"_png")),this.person.x=n,this.person.y=i,this.person.scaleX=o,this.person.alpha=0,this.person.anchorOffsetX=c,this.person.anchorOffsetY=h,this.addChild(this.person),egret.Tween.get(this.person).to({x:n,y:s,alpha:1},100).call(function(){egret.Tween.get(e.person).to({x:n,y:i,alpha:0},500)}),r},e.prototype.getForce=function(t,e){var n={x:0,y:0};return n.x=t,n.y=1.1*e,n},e.prototype.ballAnim=function(t){if(t.stageX>=this.ball.x-this.ball.width/2&&t.stageX<=this.ball.x+this.ball.width/2&&t.stageY>=this.ball.y-this.ball.height/2&&t.stageY<=this.ball.y+this.ball.height/2){var e,n=this.personShow(t);e=n.x>0?1:-1;var i=n.x,r=n.y;this.body.force.x=0,this.body.force.y=0,this.body.angularVelocity=0,this.body.applyImpulse([i,r]),this.body.angularVelocity=3*e}},e.prototype.addWorld=function(){var t=new P2World(0,-11);this.world=t;var e=t.createPlane(2*Math.PI,0,3),n=t.createPlane(-Math.PI/2,0,0),i=t.createPlane(Math.PI/2,common.curWidth()/common.factor,0),r=t.createCircleBodyShape(1.5);r.position[0]=common.curWidth()/2/common.factor,r.position[1]=(common.curHeight()-250)/common.factor,t.theWorld.addBody(r),this.body=r,r.userData.skin=this.ball,this.ball.x=common.curWidth(),this.ball.y=250;var o=new p2.Material,a=new p2.Material,s=new p2.Material;e.shapes[0].material=o,n.shapes[0].material=i.shapes[0].material=a,r.shapes[0].material=s;var c=new p2.ContactMaterial(s,o,{friction:.15,restitution:.6}),h=new p2.ContactMaterial(s,a,{friction:1,restitution:.85});t.theWorld.addContactMaterial(c),t.theWorld.addContactMaterial(h)},e.prototype.updateShadow=function(){var t=this.ball.y/(common.curHeight()-150-75);this.shadow.alpha=t,this.shadow.x=this.ball.x,this.shadow.scaleX=this.shadow.scaleY=t},e.prototype.backHome=function(){var t=new SceneEvents(SceneEvents.SCENE_CHANGE);t.eventType=SceneEvents.BACK_HOME,t.eventObj=this,ViewManager.getInstance().dispatchEvent(t)},e.prototype.enterFrame=function(){this.updateShadow()},e}(egret.DisplayObjectContainer);__reflect(SceneGame.prototype,"SceneGame");